{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'styling.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet">
    <title>DevHub.io</title>
</head>

<body>
    <div class="container">
        <div class="website-header">
            <div class="title">
                <a href="#">DevHub.io</a>
            </div>
        {% if user.is_authenticated and user.email == profile.email %}
            <button class="button1" type="button">Edit Profile</button>
        {% else %}
            <text>not login or not your own profile</text>
        {% endif %}
        
        </div>
        <br><br><br><br>
        <div class="bio-background"></div>
        <div class="elevator-pitch-video">This is {{profile.first_name}}'s profile page</div>
        <div class="chat-header">Chat Messages
            <div class="message-container">
                <input type="text" class="message-input" placeholder="Enter your message">
                {% if user.is_authenticated and user.email == profile.email %}
                    <button type="button" class="send-button" disabled>Cannot send message to self</button>
                {% elif not user.is_authenticated %}
                    <button type="button" class="send-button" disabled>Please Login First</button>
                {% else %}
                    <button type="button" class="send-button">Send</button>
                {% endif %}
            </div>
        </div>
        <div class="chat-background">
            where the messages goes
        </div>
</body>

<script>
    const roomName = '2'
    const socket = new WebSocket(
        'ws://'
            + window.location.host
            + '/ws/chat/' + roomName + '/'
    );;

    socket.onmessage = function(event) {
        console.log("Message from server:", event.data);
    };

    socket.onopen = function(event) {
        console.log("WebSocket connection opened");
    };

    socket.onmessage = function(event) {
        const chatBackground = document.querySelector('.chat-background');
        const newMessage = document.createElement('div');
        newMessage.textContent = event.data;
        chatBackground.appendChild(newMessage);
    };

    document.querySelector('.send-button').addEventListener('click', function() {
        console.log('send button clicked');
        const messageInput = document.querySelector('.message-input');
        const message = messageInput.value;
        console.log(message)
        if (message.trim() !== '') {
            socket.send(message);
            messageInput.value = '';
        }
    });
</script>
</html>